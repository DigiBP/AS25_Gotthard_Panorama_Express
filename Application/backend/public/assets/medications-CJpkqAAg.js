import{j as I,r as u,c as D}from"./index-x6LvLTz9.js";const A=I("carts",()=>{const n=u([]),i=u([]),l=u(!1),c=u(null),p=D(()=>n.value.length);async function f(){try{const t=await fetch("/api/carts",{method:"GET"});if(!t.ok)throw new Error(`Failed to fetch carts (${t.status})`);const a=await t.json();return n.value=Array.isArray(a)?a:[],n.value}catch(t){return console.error(t),c.value=t?.message||"Failed to load carts",n.value=[],n.value}}async function v(){try{const t=await fetch("/api/cart-items",{method:"GET"});if(!t.ok)throw new Error(`Failed to fetch cart-items (${t.status})`);const a=await t.json();return i.value=Array.isArray(a)?a:[],i.value}catch(t){return console.error(t),c.value=t?.message||"Failed to load cart-items",i.value=[],i.value}}async function m(){l.value=!0,c.value=null;try{await Promise.all([v(),f()]),n.value=n.value.map(t=>({...t,items:i.value.filter(a=>a.cart_id===t.id)})),console.log("Carts loaded with items:",n.value)}catch{}finally{l.value=!1}}m();async function y(t){try{const a=await fetch("/api/carts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const h=(await a.json().catch(()=>({}))).detail||`Failed to create cart (${a.status})`;throw new Error(h)}const r=await a.json();return n.value.push(r),r}catch(a){throw console.error(a),a}}async function w(t,a){try{const r={cart_id:t,...a},s=await fetch("/api/cart-items/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const F=(await s.json().catch(()=>({}))).detail||`Failed to add medication (${s.status})`;throw new Error(F)}return await s.json()}catch(r){throw console.error(r),r}}async function g(t,a=[]){try{const r=await y(t);if(a.length>0){for(const s of a)s.medication_id&&await w(r.id,{medication_id:s.medication_id,amount:s.amount,inventory_id:s.inventory_id,time_sensitive:s.time_sensitive});await o()}return r}catch(r){throw console.error(r),r}}async function E(t,a){try{const r=await fetch(`/api/carts/${t}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_status:a})});if(!r.ok){const F=(await r.json().catch(()=>({}))).detail||`Failed to update cart status (${r.status})`;throw new Error(F)}const s=await r.json(),h=n.value.findIndex(j=>j.id===t);return h!==-1&&(n.value[h]=s),s}catch(r){throw console.error(r),r}}function e(t){return n.value.find(a=>a.id===t)||null}async function o(){l.value=!0;try{return await m(),n.value}finally{l.value=!1}}async function d(t){try{const a=await fetch(`/api/cart-items/${t}`,{method:"DELETE"});if(!a.ok){const s=(await a.json().catch(()=>({}))).detail||"Failed to remove medication";throw new Error(s)}await o()}catch(a){throw console.error("Remove medication error:",a),c.value=a.message,a}}async function C(t){try{const a=await fetch(`/api/carts/${t}`,{method:"DELETE"});if(!a.ok){const s=(await a.json().catch(()=>({}))).detail||"Failed to remove cart";throw new Error(s)}n.value=n.value.filter(r=>r.id!==t),i.value=i.value.filter(r=>r.cart_id!==t)}catch(a){throw console.error("Remove cart error:",a),c.value=a.message,a}}return{carts:n,cart_items:i,count:p,loading:l,error:c,addCart:y,addMedicationToCart:w,addCartWithMedications:g,updateCart:E,getCart:e,fetchCarts:f,fetchCartItems:v,refresh:o,removeMedicationFromCart:d,removeCart:C}}),_=I("medications",()=>{const n=u([]),i=u([]),l=u(!1),c=u(null),p=D(()=>n.value.map(e=>{const o=[e.name];e.dosage&&o.push(e.dosage),e.quantity&&!e.dosage&&o.push(e.quantity);const d=i.value.filter(t=>t.medicationId===e.medicationId).reduce((t,a)=>t+(a.amount||0),0),C=i.value.find(t=>t.medicationId===e.medicationId)?.unit||"";return{label:o.join(" â€” "),value:e.medicationId,meta:e,availableAmount:d,unit:C}}));async function f(){l.value=!0,c.value=null;try{const e=await fetch("/api/medications",{method:"GET"});if(!e.ok)throw new Error(`Failed to fetch medications (${e.status})`);const o=await e.json();return n.value=Array.isArray(o)?o:[],console.log(o),n.value}catch(e){return console.error(e),c.value=e?.message||"Failed to load medications",n.value=[],n.value}finally{l.value=!1}}async function v(){l.value=!0,c.value=null;try{const e=await fetch("/api/inventory",{method:"GET"});if(!e.ok)throw new Error(`Failed to fetch inventory (${e.status})`);const o=await e.json();return i.value=Array.isArray(o)?o:[],console.log(o),i.value}catch(e){return console.error(e),c.value=e?.message||"Failed to load inventory",i.value=[],i.value}finally{l.value=!1}}f(),v();function m(e){return n.value.find(o=>o.medicationId===e)||null}function y(){return Promise.all([f(),v()])}function w(e){return i.value.filter(o=>o.medicationId===e)}function g(e){return i.value.filter(o=>o.medicationId===e).reduce((o,d)=>o+(d.amount||0),0)}function E(e){const o=i.value.find(d=>d.medicationId===e);return o?o.id:null}return{medications:n,inventory:i,options:p,loading:l,error:c,byId:m,refresh:y,fetchMedicalData:f,fetchInventory:v,getInventoryForMedication:w,getTotalAvailable:g,getFirstInventoryId:E}});export{A as a,_ as u};
