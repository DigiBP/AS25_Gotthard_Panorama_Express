import{u as k,a as b}from"./medications-CBhGBPKD.js";import{_ as B,a as u,b as e,g as x,v as P,f as y,h as f,F as h,e as S,n as g,t as a,d as c,o as p}from"./index-D2lfA9pA.js";const C={name:"InventoryView",data(){return{meds:null,carts:null,search:"",unitFilter:"",lowStockThreshold:0,sortBy:{key:"name",asc:!0},expPage:1,expPageSize:10,expSortBy:{key:"daysLeft",asc:!0},invPage:1,invPageSize:10}},created(){this.meds=k(),this.carts=b()},computed:{units(){return Array.from(new Set((this.meds.inventory||[]).map(r=>r.unit).filter(Boolean)))},expiringOnUsedCarts(){const r=(this.carts.carts||[]).filter(o=>{const l=String(o.status||o.CartStatus||o.cartStatus||"").toLowerCase();return l==="in-use"||l==="used"}),t=[];return r.forEach(o=>{(Array.isArray(o.items)?o.items:[]).forEach(n=>{const s=(this.meds.medications||[]).find(v=>v.medicationId===n.medication_id||v.medicationId===n.medicationId),i=s?.name||n.medication_id||n.medicationId||"Unknown",d=n.expiration_date||n.expirationDate||s?.expirationDate||null,m=this.daysUntil(d);t.push({key:`${o.id||o.CartId}-${n.id||n.medication_id}`,cartId:o.id||o.CartId,name:i,expirationDate:d||"-",daysLeft:m})})}),t.sort((o,l)=>o.daysLeft-l.daysLeft)},expiringOnUsedCartsFiltered(){const r=String(this.search||"").toLowerCase();return this.expiringOnUsedCarts.filter(t=>{if(r&&!t.name.toLowerCase().includes(r))return!1;if(this.unitFilter){const o=(this.meds.medications||[]).find(l=>l.name===t.name);if(!o||(o.unit||"")!==this.unitFilter)return!1}return!0})},inventoryTotals(){const r=new Map;return(this.meds.inventory||[]).forEach(t=>{const o=(this.meds.medications||[]).find(m=>m.medicationId===t.medicationId),l=o?.name||t.medicationId||"unknown",n=t.unit||o?.unit||"",s=`${l}::${n}`,i=Number(t.amount)||0,d=r.get(s)||{name:l,unit:n,totalQuantity:0,locations:new Set,earliestExpiry:null,key:s};if(d.totalQuantity+=i,t.location&&d.locations.add(t.location),t.expirationDate){const m=d.earliestExpiry?new Date(d.earliestExpiry):null,v=new Date(t.expirationDate);(!m||v<m)&&(d.earliestExpiry=t.expirationDate)}r.set(s,d)}),Array.from(r.values()).map(t=>({key:t.key,name:t.name,unit:t.unit,totalQuantity:t.totalQuantity,locations:Array.from(t.locations),earliestExpiry:t.earliestExpiry}))},inventoryFilteredSorted(){const r=String(this.search||"").toLowerCase();let t=this.inventoryTotals.filter(o=>!(this.unitFilter&&o.unit!==this.unitFilter||r&&!o.name.toLowerCase().includes(r)));return t.sort((o,l)=>{const n=this.sortBy.key;let s=o[n],i=l[n];return(n==="quantity"||n==="totalQuantity")&&(s=o.totalQuantity,i=l.totalQuantity),s==null?1:i==null?-1:typeof s=="string"?this.sortBy.asc?s.localeCompare(i):i.localeCompare(s):this.sortBy.asc?s-i:i-s}),t},expiringSorted(){const r=[...this.expiringOnUsedCartsFiltered],t=this.expSortBy.key;return r.sort((o,l)=>{let n=o[t],s=l[t];return n==null?1:s==null?-1:typeof n=="string"?this.expSortBy.asc?n.localeCompare(s):s.localeCompare(n):this.expSortBy.asc?n-s:s-n}),r},expiringPaginated(){const r=Math.max(1,this.expPage),t=Math.max(1,this.expPageSize),o=this.expiringSorted,l=(r-1)*t;return o.slice(l,l+t)},inventoryPaginated(){const r=Math.max(1,this.invPage),t=Math.max(1,this.invPageSize),o=this.inventoryFilteredSorted,l=(r-1)*t;return o.slice(l,l+t)}},methods:{daysUntil(r){if(!r)return 1/0;const o=new Date(r).getTime()-Date.now();return Math.ceil(o/(1e3*60*60*24))},toggleSort(r){this.sortBy.key===r?this.sortBy.asc=!this.sortBy.asc:(this.sortBy.key=r,this.sortBy.asc=!0)},toggleExpSort(r){this.expSortBy.key===r?this.expSortBy.asc=!this.expSortBy.asc:(this.expSortBy.key=r,this.expSortBy.asc=!0)},sortIndicator(r){return this.sortBy.key!==r?"":this.sortBy.asc?"▲":"▼"},sortIndicatorExp(r){return this.expSortBy.key!==r?"":this.expSortBy.asc?"▲":"▼"}},watch:{search(){this.expPage=1,this.invPage=1},unitFilter(){this.expPage=1,this.invPage=1},lowStockThreshold(){this.expPage=1,this.invPage=1},expPageSize(){this.expPage=1,this.invPage=1},invPageSize(){this.expPage=1,this.invPage=1}}},I={class:"view inventory-view"},w={class:"controls"},E=["value"],z={class:"expiring"},F={class:"table"},D={class:"indicator"},L={class:"indicator"},M={class:"indicator"},U={key:0},T={class:"pagination"},V=["disabled"],N=["disabled"],Q={class:"inventory"},q={class:"table"},A={class:"indicator"},O={class:"indicator"},j={key:0},G={class:"pagination"},H=["disabled"],J=["disabled"];function K(r,t,o,l,n,s){return p(),u("div",I,[t[36]||(t[36]=e("h1",null,"Inventory",-1)),e("section",w,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>n.search=i),placeholder:"Search by name",class:"search"},null,512),[[P,n.search]]),e("label",null,[t[15]||(t[15]=y("Unit: ",-1)),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=i=>n.unitFilter=i)},[t[14]||(t[14]=e("option",{value:""},"All",-1)),(p(!0),u(h,null,S(s.units,i=>(p(),u("option",{key:i,value:i},a(i),9,E))),128))],512),[[f,n.unitFilter]])]),e("label",null,[t[16]||(t[16]=y("Low stock threshold: ",-1)),x(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=i=>n.lowStockThreshold=i),min:"0"},null,512),[[P,n.lowStockThreshold,void 0,{number:!0}]])])]),e("section",z,[t[24]||(t[24]=e("h2",null,"Expiring soon (on used carts)",-1)),t[25]||(t[25]=e("p",{class:"muted"},'Items from carts with status "used". Sorted by soonest expiration.',-1)),e("table",F,[e("thead",null,[e("tr",null,[t[20]||(t[20]=e("th",null,"Cart",-1)),e("th",{onClick:t[3]||(t[3]=i=>s.toggleExpSort("name")),class:g({sorted:n.expSortBy.key==="name"})},[t[17]||(t[17]=y("Medication ",-1)),e("span",D,a(s.sortIndicatorExp("name")),1)],2),e("th",{onClick:t[4]||(t[4]=i=>s.toggleExpSort("expirationDate")),class:g({sorted:n.expSortBy.key==="expirationDate"})},[t[18]||(t[18]=y("Expires ",-1)),e("span",L,a(s.sortIndicatorExp("expirationDate")),1)],2),e("th",{onClick:t[5]||(t[5]=i=>s.toggleExpSort("daysLeft")),class:g({sorted:n.expSortBy.key==="daysLeft"})},[t[19]||(t[19]=y("Days left ",-1)),e("span",M,a(s.sortIndicatorExp("daysLeft")),1)],2)])]),e("tbody",null,[(p(!0),u(h,null,S(s.expiringPaginated,i=>(p(),u("tr",{key:i.key},[e("td",null,a(i.cartId),1),e("td",null,a(i.name),1),e("td",null,a(i.expirationDate),1),e("td",{class:g({danger:i.daysLeft<=7})},a(i.daysLeft),3)]))),128)),s.expiringOnUsedCartsFiltered.length===0?(p(),u("tr",U,[...t[21]||(t[21]=[e("td",{colspan:"4",class:"muted"},"No expiring items match the filters.",-1)])])):c("",!0)])]),e("div",T,[e("label",null,[t[23]||(t[23]=y("Page size: ",-1)),x(e("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>n.expPageSize=i)},[...t[22]||(t[22]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:25},"25",-1)])],512),[[f,n.expPageSize,void 0,{number:!0}]])]),e("button",{disabled:n.expPage<=1,onClick:t[7]||(t[7]=i=>n.expPage=Math.max(1,n.expPage-1))},"Prev",8,V),e("span",null,"Page "+a(n.expPage)+" of "+a(Math.max(1,Math.ceil(s.expiringSorted.length/n.expPageSize))),1),e("button",{disabled:n.expPage*n.expPageSize>=s.expiringSorted.length,onClick:t[8]||(t[8]=i=>n.expPage=n.expPage+1)},"Next",8,N)])]),e("section",Q,[t[34]||(t[34]=e("h2",null,"Inventory totals",-1)),t[35]||(t[35]=e("p",{class:"muted"},"Aggregated by medication name + unit.",-1)),e("table",q,[e("thead",null,[e("tr",null,[e("th",{onClick:t[9]||(t[9]=i=>s.toggleSort("name")),class:g({sorted:n.sortBy.key==="name"})},[t[26]||(t[26]=y("Name ",-1)),e("span",A,a(s.sortIndicator("name")),1)],2),e("th",{onClick:t[10]||(t[10]=i=>s.toggleSort("quantity")),class:g({sorted:n.sortBy.key==="quantity"})},[t[27]||(t[27]=y("Total quantity ",-1)),e("span",O,a(s.sortIndicator("quantity")),1)],2),t[28]||(t[28]=e("th",null,"Unit",-1)),t[29]||(t[29]=e("th",null,"Locations",-1)),t[30]||(t[30]=e("th",null,"Earliest expiry",-1))])]),e("tbody",null,[(p(!0),u(h,null,S(s.inventoryPaginated,i=>(p(),u("tr",{key:i.key},[e("td",null,a(i.name),1),e("td",{class:g({low:i.totalQuantity<=n.lowStockThreshold})},a(i.totalQuantity),3),e("td",null,a(i.unit),1),e("td",null,a(i.locations.join(", ")),1),e("td",null,a(i.earliestExpiry||"-"),1)]))),128)),s.inventoryFilteredSorted.length===0?(p(),u("tr",j,[...t[31]||(t[31]=[e("td",{colspan:"5",class:"muted"},"No inventory items match the filters.",-1)])])):c("",!0)])]),e("div",G,[e("label",null,[t[33]||(t[33]=y("Page size: ",-1)),x(e("select",{"onUpdate:modelValue":t[11]||(t[11]=i=>n.invPageSize=i)},[...t[32]||(t[32]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)])],512),[[f,n.invPageSize,void 0,{number:!0}]])]),e("button",{disabled:n.invPage<=1,onClick:t[12]||(t[12]=i=>n.invPage=Math.max(1,n.invPage-1))},"Prev",8,H),e("span",null,"Page "+a(n.invPage)+" of "+a(Math.max(1,Math.ceil(s.inventoryFilteredSorted.length/n.invPageSize))),1),e("button",{disabled:n.invPage*n.invPageSize>=s.inventoryFilteredSorted.length,onClick:t[13]||(t[13]=i=>n.invPage=n.invPage+1)},"Next",8,J)])])])}const X=B(C,[["render",K],["__scopeId","data-v-b1afed69"]]);export{X as default};
