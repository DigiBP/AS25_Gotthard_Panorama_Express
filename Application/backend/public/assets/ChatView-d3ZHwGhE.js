import{r as _,m as h,p as k,_ as w,a as u,b as a,d as p,n as S,q as g,t as m,F as b,e as y,o as d,s as W}from"./index-D2lfA9pA.js";function C(i){const e=_(null),s=_(!1);let t=null;function f(){return window.location.protocol==="https:"?"wss:":"ws:"}function l(){const n=`${f()}//${window.location.host}/api/notifications/ws`;console.log("Connecting to WebSocket:",n),e.value=new WebSocket(n),e.value.onopen=()=>{console.log("WebSocket connected"),s.value=!0},e.value.onmessage=c=>{try{const r=JSON.parse(c.data);console.log("Received WebSocket message:",r),i&&i(r)}catch(r){console.error("Failed to parse WebSocket message:",r),i&&i({event_type:"error",message:`Failed to parse message: ${c.data}`,cart_id:null})}},e.value.onerror=c=>{console.error("WebSocket error:",c),s.value=!1},e.value.onclose=()=>{console.log("WebSocket disconnected"),s.value=!1,t=setTimeout(()=>{console.log("Attempting to reconnect..."),l()},3e3)}}function v(){t&&(clearTimeout(t),t=null),e.value&&(e.value.close(),e.value=null),s.value=!1}return h(()=>{l()}),k(()=>{v()}),{socket:e,isConnected:s,connect:l,disconnect:v}}const x={class:"view chat-view"},$={class:"ws-status"},T={class:"status-text"},D={key:0,class:"muted"},F={class:"meta"},N={class:"text"},V={key:0,class:"error"},A={__name:"ChatView",setup(i){const e=_([]),s=_(""),t=_(null);function f(o){const n=`[${o.event_type}] ${o.message}${o.cart_id?` (Cart: ${o.cart_id})`:""}`;e.value.push({time:new Date().toISOString(),text:n}),W(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})}const{isConnected:l}=C(f);function v(o){try{return new Date(o).toLocaleString()}catch{return o}}return(o,n)=>(d(),u("div",x,[n[0]||(n[0]=a("h1",null,"Log",-1)),a("section",$,[a("span",{class:S(["status-indicator",{connected:g(l)}])},null,2),a("span",T,"WebSocket "+m(g(l)?"Connected":"Disconnected"),1)]),a("section",{class:"chat-log",ref_key:"logArea",ref:t},[e.value.length===0?(d(),u("div",D,"No messages yet")):p("",!0),(d(!0),u(b,null,y(e.value,(c,r)=>(d(),u("div",{key:r,class:"chat-message"},[a("div",F,m(v(c.time)),1),a("div",N,m(c.text),1)]))),128))],512),s.value?(d(),u("section",V,m(s.value),1)):p("",!0)]))}},L=w(A,[["__scopeId","data-v-4fcd459a"]]);export{L as default};
