import{_ as O,k as j,c as m,a as u,o as d,b as e,t as v,d as _,f as p,F as S,e as D,r as g,w as q,g as y,v as $,h as V,n as x,l as G}from"./index-D2lfA9pA.js";import{a as H,u as J}from"./medications-CBhGBPKD.js";const K={class:"cart-card"},Q={class:"cart-header"},X={style:{"font-size":"12px",color:"#888"}},Y={class:"header-actions"},Z={class:"status"},ee={class:"cart-body"},te={key:0},ae={key:1,class:"medication"},oe={class:"med-name"},ne={class:"med-leftover"},ie={class:"med-time"},se=["checked","aria-label"],le={class:"med-actions"},re=["onClick"],ue={key:2,class:"med-empty"},de={__name:"Cart",props:{cart:{type:Object,required:!0}},setup(R){const n=j(R,"cart"),F=m(()=>n.value.CartStatus??n.value.cartStatus??n.value.status??"unknown"),C=m(()=>n.value.patientId??n.value.patientID??n.value.patient??"â€”"),w=m(()=>n.value.CartId??n.value.id??n.value.cartId??"â€”"),I=m(()=>n.value.Operation??n.value.plannedOperation??n.value.operation??"â€”"),h=m(()=>n.value.FormofAnaesthesia??n.value.formOfAnaesthesia??n.value.FormOfAnaesthesia??"â€”"),k=m(()=>n.value.operationDate??n.value.date??""),M=m(()=>n.value.OperationRoom??n.value.operationRoom??n.value.room??"â€”"),i=m(()=>Array.isArray(n.value.items)&&n.value.items.length?n.value.items:n.value.Medications??n.value.Medication??n.value.medication??""),c=m(()=>{const o=i.value;return o?Array.isArray(o)?o.map(r=>({id:r.id,label:r.medication_id||r.medicationId||"unknown",amount:r.amount??"",timeSensitive:!!(r.time_sensitive??r.timeSensitive)})):(Array.isArray(o)?o.map(r=>String(r).trim()).filter(Boolean):String(o).split(",").map(r=>r.replace(/\s*\'?$|^\'/g,"").trim()).filter(Boolean)).map(r=>({label:r,amount:"â€”",timeSensitive:!1})):[]});return(o,s)=>(d(),u("article",K,[e("header",Q,[e("div",null,[e("h3",null,"Patient: "+v(C.value),1),e("div",X,"Cart: "+v(w.value)+" Â· Room: "+v(M.value),1)]),e("div",Y,[e("span",Z,v(F.value),1),e("button",{onClick:s[0]||(s[0]=r=>o.$emit("remove-cart")),class:"btn-delete-cart",title:"Delete cart"}," ðŸ—‘ ")])]),e("div",ee,[e("p",null,[s[1]||(s[1]=e("strong",null,"Operation:",-1)),p(" "+v(I.value),1)]),e("p",null,[s[2]||(s[2]=e("strong",null,"Anaesthesia:",-1)),p(" "+v(h.value),1)]),k.value?(d(),u("p",te,[s[3]||(s[3]=e("strong",null,"Date:",-1)),p(" "+v(k.value),1)])):_("",!0),c.value.length?(d(),u("table",ae,[s[4]||(s[4]=e("thead",null,[e("tr",null,[e("th",{class:"med-col-name"},"Medicine"),e("th",{class:"med-col-leftover"},"Amount"),e("th",{class:"med-col-time"},"Time critical"),e("th",{class:"med-col-actions"},"Actions")])],-1)),e("tbody",null,[(d(!0),u(S,null,D(c.value,(r,T)=>(d(),u("tr",{key:T},[e("td",oe,v(r.label),1),e("td",ne,v(r.amount),1),e("td",ie,[e("input",{type:"checkbox",checked:r.timeSensitive,"aria-label":"Time critical for "+r.label,disabled:""},null,8,se)]),e("td",le,[r.id?(d(),u("button",{key:0,onClick:N=>o.$emit("remove-medication",r.id),class:"btn-remove",title:"Remove medication"}," Ã— ",8,re)):_("",!0)])]))),128))])])):(d(),u("p",ue,"No medications listed"))])]))}},ve=O(de,[["__scopeId","data-v-b3b73ff6"]]),ce={class:"view dashboard-view"},me={class:"header"},pe={class:"controls"},be=["disabled"],ye={class:"form-grid"},fe={class:"medications-section"},_e=["onUpdate:modelValue"],Ce=["value"],he=["onUpdate:modelValue"],ke=["onClick"],Ae={class:"form-actions"},ge=["disabled"],$e={class:"form-grid"},Me=["value"],we={key:0,class:"available-hint"},Ie={class:"form-actions"},Se=["disabled"],De={class:"carts-grid"},Fe=["onClick"],Te={key:2,class:"empty-state"},Ve={__name:"DigitalCarts",setup(R){const f=H(),n=J(),F=m(()=>f.carts),C=m(()=>f.loading),w=m(()=>n.options),I=m(()=>{if(!s.value.medication_id)return null;const l=w.value.find(t=>t.value===s.value.medication_id);return l?{amount:l.availableAmount,unit:l.unit}:null}),h=g(!1),k=g(!1),M=g(null),i=g(""),c=g("success"),o=g({patientId:"",operation:"",operationDate:"",anaesthesiaType:"",roomNumber:"",status:"Prepared",medications:[]}),s=g({cart_id:null,medication_id:"",amount:1,inventory_id:1,time_sensitive:!1}),r=()=>{o.value={patientId:"",operation:"",operationDate:"",anaesthesiaType:"",roomNumber:"",status:"Prepared",medications:[]},i.value=""},T=()=>{o.value.medications.push({medication_id:"",amount:1,inventory_id:1,time_sensitive:!1})},N=l=>{o.value.medications.splice(l,1)},U=()=>{s.value={cart_id:M.value,inventory_id:1,medication_id:"",amount:1,time_sensitive:!1}},B=async()=>{try{i.value="";const l=o.value.medications.map(a=>{const A=n.getFirstInventoryId(a.medication_id);if(!A)throw new Error(`Medication ${a.medication_id} not found in inventory`);return{...a,inventory_id:A}}),t={patientId:o.value.patientId,operation:o.value.operation,operationDate:o.value.operationDate,anaesthesiaType:o.value.anaesthesiaType,roomNumber:o.value.roomNumber,status:o.value.status};await f.addCartWithMedications(t,l),i.value="Cart created successfully!",c.value="success",r(),setTimeout(()=>{h.value=!1,i.value=""},2e3)}catch(l){i.value=`Failed to create cart: ${l.message}`,c.value="error"}},P=l=>{M.value=l,s.value.cart_id=l,k.value=!0,i.value=""},E=async()=>{try{i.value="";const l=n.getFirstInventoryId(s.value.medication_id);if(!l){i.value="Selected medication not found in inventory",c.value="error";return}await f.addMedicationToCart(M.value,{medication_id:s.value.medication_id,amount:s.value.amount,inventory_id:l,time_sensitive:s.value.time_sensitive}),i.value="Medication added to cart successfully!",c.value="success",U(),await f.refresh(),setTimeout(()=>{k.value=!1,i.value=""},2e3)}catch(l){i.value=`Failed to add medication: ${l.message}`,c.value="error"}},z=async l=>{if(confirm("Are you sure you want to remove this medication from the cart?"))try{await f.removeMedicationFromCart(l),i.value="Medication removed successfully!",c.value="success",setTimeout(()=>{i.value=""},2e3)}catch(t){i.value=`Failed to remove medication: ${t.message}`,c.value="error"}},L=async l=>{if(confirm("Are you sure you want to delete this cart? This will also remove all medications in it."))try{i.value="",await f.removeCart(l),i.value="Cart deleted successfully!",c.value="success",setTimeout(()=>{i.value=""},2e3)}catch(t){i.value=`Failed to delete cart: ${t.message}`,c.value="error"}},W=async()=>{try{i.value="",await f.refresh()}catch(l){i.value=`Failed to refresh: ${l.message}`,c.value="error"}};return(l,t)=>(d(),u("div",ce,[e("div",me,[t[10]||(t[10]=e("h1",null,"Digital carts",-1)),e("div",pe,[e("button",{onClick:W,disabled:C.value,class:"btn-refresh"},v(C.value?"Loading...":"ðŸ”„ Refresh"),9,be),e("button",{onClick:t[0]||(t[0]=a=>h.value=!h.value),class:"btn-add"},v(h.value?"âœ– Cancel":"+ Add Cart"),1)])]),h.value?(d(),u("form",{key:0,onSubmit:q(B,["prevent"]),class:"add-cart-form"},[t[21]||(t[21]=e("h2",null,"Create New Cart",-1)),e("div",ye,[e("label",null,[t[11]||(t[11]=p(" Patient ID: ",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.patientId=a),type:"text",required:""},null,512),[[$,o.value.patientId]])]),e("label",null,[t[12]||(t[12]=p(" Operation: ",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.operation=a),type:"text",required:""},null,512),[[$,o.value.operation]])]),e("label",null,[t[13]||(t[13]=p(" Operation Date: ",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.operationDate=a),type:"date",required:""},null,512),[[$,o.value.operationDate]])]),e("label",null,[t[14]||(t[14]=p(" Anaesthesia Type: ",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.anaesthesiaType=a),type:"text",required:""},null,512),[[$,o.value.anaesthesiaType]])]),e("label",null,[t[15]||(t[15]=p(" Room Number: ",-1)),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.roomNumber=a),type:"text",required:""},null,512),[[$,o.value.roomNumber]])]),e("label",null,[t[17]||(t[17]=p(" Status: ",-1)),y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.status=a),required:""},[...t[16]||(t[16]=[e("option",{value:"Prepared"},"Prepared",-1),e("option",{value:"In-Use"},"In-Use",-1),e("option",{value:"Closed"},"Closed",-1)])],512),[[V,o.value.status]])])]),e("div",fe,[t[19]||(t[19]=e("h3",null,"Medications",-1)),t[20]||(t[20]=e("p",{class:"hint"},"Select medications from the inventory to add to this cart",-1)),(d(!0),u(S,null,D(o.value.medications,(a,A)=>(d(),u("div",{key:A,class:"medication-row"},[y(e("select",{"onUpdate:modelValue":b=>a.medication_id=b,required:""},[t[18]||(t[18]=e("option",{value:"",disabled:""},"Select medication",-1)),(d(!0),u(S,null,D(w.value,b=>(d(),u("option",{key:b.value,value:b.value},v(b.label)+" (Available: "+v(b.availableAmount)+" "+v(b.unit)+") ",9,Ce))),128))],8,_e),[[V,a.medication_id]]),y(e("input",{"onUpdate:modelValue":b=>a.amount=b,type:"number",min:"0.1",step:"0.1",placeholder:"Amount",required:""},null,8,he),[[$,a.amount,void 0,{number:!0}]]),e("button",{type:"button",onClick:b=>N(A),class:"btn-remove-med"},"âœ–",8,ke)]))),128)),e("button",{type:"button",onClick:T,class:"btn-add-med-inline"},"+ Add Medication")]),e("div",Ae,[e("button",{type:"submit",class:"btn-submit",disabled:C.value},"Create Cart",8,ge),e("button",{type:"button",onClick:r,class:"btn-cancel"},"Reset")]),i.value?(d(),u("div",{key:0,class:x(["message",c.value])},v(i.value),3)):_("",!0)],32)):_("",!0),k.value?(d(),u("form",{key:1,onSubmit:q(E,["prevent"]),class:"add-cart-form"},[e("h2",null,"Add Existing Medication to Cart #"+v(M.value),1),t[25]||(t[25]=e("p",{class:"hint"},"Select from the medications",-1)),e("div",$e,[e("label",null,[t[23]||(t[23]=p(" Medication: ",-1)),y(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.medication_id=a),required:""},[t[22]||(t[22]=e("option",{value:"",disabled:""},"Select medication",-1)),(d(!0),u(S,null,D(w.value,a=>(d(),u("option",{key:a.value,value:a.value},v(a.label)+" (Available: "+v(a.availableAmount)+" "+v(a.unit)+") ",9,Me))),128))],512),[[V,s.value.medication_id]])]),e("label",null,[t[24]||(t[24]=p(" Amount: ",-1)),y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.amount=a),type:"number",min:"0.1",step:"0.1",required:""},null,512),[[$,s.value.amount,void 0,{number:!0}]]),I.value?(d(),u("span",we," Available: "+v(I.value.amount)+" "+v(I.value.unit),1)):_("",!0)])]),e("div",Ie,[e("button",{type:"submit",class:"btn-submit",disabled:C.value},"Add Medication",8,Se),e("button",{type:"button",onClick:t[9]||(t[9]=a=>{k.value=!1,U()}),class:"btn-cancel"},"Cancel")]),i.value?(d(),u("div",{key:0,class:x(["message",c.value])},v(i.value),3)):_("",!0)],32)):_("",!0),e("section",De,[(d(!0),u(S,null,D(F.value,a=>(d(),u("div",{key:a.id,class:"cart-wrapper"},[G(ve,{cart:a,onRemoveMedication:z,onRemoveCart:A=>L(a.id)},null,8,["cart","onRemoveCart"]),e("button",{onClick:A=>P(a.id),class:"btn-add-med"}," + Add Medication ",8,Fe)]))),128))]),F.value.length===0&&!C.value?(d(),u("div",Te,' No carts found. Create one using the "Add Cart" button above. ')):_("",!0)]))}},Ue=O(Ve,[["__scopeId","data-v-72be20a7"]]);export{Ue as default};
