import{m as _,r as l,c as T}from"./index-DG90UNWf.js";const M=_("carts",()=>{const o=l([]),n=l([]),i=l(!1),s=l(null),p=T(()=>o.value.length);async function f(){try{const a=await fetch("/api/carts",{method:"GET"});if(!a.ok)throw new Error(`Failed to fetch carts (${a.status})`);const t=await a.json();return o.value=Array.isArray(t)?t:[],o.value}catch(a){return console.error(a),s.value=a?.message||"Failed to load carts",o.value=[],o.value}}async function m(){try{const a=await fetch("/api/cart-items",{method:"GET"});if(!a.ok)throw new Error(`Failed to fetch cart-items (${a.status})`);const t=await a.json();return n.value=Array.isArray(t)?t:[],n.value}catch(a){return console.error(a),s.value=a?.message||"Failed to load cart-items",n.value=[],n.value}}async function w(){i.value=!0,s.value=null;try{await Promise.all([m(),f()]),o.value=o.value.map(a=>({...a,items:n.value.filter(t=>t.cart_id===a.id)})),console.log("Carts loaded with items:",o.value)}catch{}finally{i.value=!1}}w();async function v(a){try{const t=await fetch("/api/carts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok){const c=(await t.json().catch(()=>({}))).detail||`Failed to create cart (${t.status})`;throw new Error(c)}const r=await t.json();return o.value.push(r),r}catch(t){throw console.error(t),t}}async function y(a,t){try{const r={cart_id:a,...t},e=await fetch("/api/cart-items/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const h=(await e.json().catch(()=>({}))).detail||`Failed to add medication (${e.status})`;throw new Error(h)}return await e.json()}catch(r){throw console.error(r),r}}async function C(a,t=[]){try{const r=await v(a);if(t.length>0){for(const e of t)e.medication_id&&await y(r.id,{medication_id:e.medication_id,amount:e.amount,inventory_id:e.inventory_id,time_sensitive:e.time_sensitive});await d()}return r}catch(r){throw console.error(r),r}}async function g(a,t){try{const r=await fetch(`/api/carts/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_status:t})});if(!r.ok){const h=(await r.json().catch(()=>({}))).detail||`Failed to update cart status (${r.status})`;throw new Error(h)}const e=await r.json(),c=o.value.findIndex(u=>u.id===a);return c!==-1&&(o.value[c]=e),e}catch(r){throw console.error(r),r}}function E(a){return o.value.find(t=>t.id===a)||null}async function d(){i.value=!0;try{return await w(),o.value}finally{i.value=!1}}async function j(a){try{const t=await fetch(`/api/cart-items/${a}`,{method:"DELETE"});if(!t.ok){const e=(await t.json().catch(()=>({}))).detail||"Failed to remove medication";throw new Error(e)}await d()}catch(t){throw console.error("Remove medication error:",t),s.value=t.message,t}}async function D(a){try{const t=await fetch(`/api/carts/${a}`,{method:"DELETE"});if(!t.ok){const e=(await t.json().catch(()=>({}))).detail||"Failed to remove cart";throw new Error(e)}o.value=o.value.filter(r=>r.id!==a),n.value=n.value.filter(r=>r.cart_id!==a)}catch(t){throw console.error("Remove cart error:",t),s.value=t.message,t}}return{carts:o,cart_items:n,count:p,loading:i,error:s,addCart:v,addMedicationToCart:y,addCartWithMedications:C,updateCart:g,getCart:E,fetchCarts:f,fetchCartItems:m,refresh:d,removeMedicationFromCart:j,removeCart:D}});export{M as u};
